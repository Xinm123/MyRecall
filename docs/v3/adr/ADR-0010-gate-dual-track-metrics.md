# ADR-0010 Gate 双轨指标策略（数值放宽 + 功能强化）

- 状态：Accepted
- 日期：2026-02-26

## Context
- 用户要求：数值型指标（如延迟、CPU）可以适度放宽，但要增加“功能是否完成、是否完善”的 Gate。
- 现状风险：若仅依赖性能阈值，可能出现“性能达标但能力不完整”的伪通过。

## Decision
- Gate 采用双轨策略：
  - 轨道 A（数值指标）：保留核心 SLO，但阈值适度放宽。
  - 轨道 B（功能指标）：增加功能完成度与完善度强制指标（必须达标）。
- Gate 判定规则：
  - 任一“功能强制项”未达标 => Gate Fail。
  - 数值项允许在放宽阈值内波动，但不得突破阶段定义上限。
- Chat 引用覆盖率采用分阶段 Soft KPI（non-blocking）：
  - P1-S5 目标 >= 85%
  - P1-S7 / Phase2 / Phase3 目标 >= 92%
  - Stretch 目标 >= 95%
- 所有统计定义与判定口径统一由 `MyRecall/docs/v3/gate_baseline.md` 管理。

## screenpipe 参考与对齐
- screenpipe 侧重点在“可用能力闭环 + 实际运行稳定性”，并不只以单一延迟数字判断可用性。
- 本决策与 screenpipe 的可用性导向一致，可在行为层对齐；差异在于 MyRecall-v3 明确把该策略制度化为 Gate 规则。

## Consequences
- 优点：
  - 减少“性能过拟合”导致的功能残缺风险。
  - 验收结果更贴近真实可用性（特别是 Chat 引用、降级、契约完整性）。
- 代价：
  - 验收维度增多，评审与文档维护成本上升。

## Risks
- 若功能清单定义不清晰，会导致 Gate 判定主观化。

## Validation
- 在验收模板中强制记录三类指标：数值、功能完成度、完善度。
- 抽检机制：随机抽取阶段记录，检查功能项是否可追溯到测试证据。
