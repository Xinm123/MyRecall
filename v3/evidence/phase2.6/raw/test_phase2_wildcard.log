============================= test session starts ==============================
platform darwin -- Python 3.11.14, pytest-9.0.2, pluggy-1.6.0 -- /opt/homebrew/Caskroom/miniforge/base/envs/v3/bin/python3
cachedir: .pytest_cache
rootdir: /Users/pyw/newpart/MyRecall
configfile: pytest.ini
plugins: anyio-4.12.1
collecting ... collected 158 items / 5 deselected / 153 selected

tests/test_phase2_6_hard_shutdown.py::test_audio_enabled_is_forced_off_by_config PASSED [  0%]
tests/test_phase2_6_hard_shutdown.py::TestHardShutdownContracts::test_v1_upload_rejects_audio_payload PASSED [  1%]
tests/test_phase2_6_hard_shutdown.py::TestHardShutdownContracts::test_legacy_upload_rejects_audio_payload PASSED [  1%]
tests/test_phase2_6_hard_shutdown.py::TestHardShutdownContracts::test_timeline_audio_source_returns_empty PASSED [  2%]
tests/test_phase2_6_hard_shutdown.py::TestHardShutdownContracts::test_primary_navigation_has_no_audio_entry PASSED [  3%]
tests/test_phase2_6_hard_shutdown.py::TestHardShutdownContracts::test_search_api_drops_audio_results PASSED [  3%]
tests/test_phase2_ab_benchmark.py::TestAudioAbBenchmarkCli::test_parse_args_defaults PASSED [  4%]
tests/test_phase2_ab_benchmark.py::TestAudioAbBenchmarkCli::test_run_benchmark_degrades_without_real_samples PASSED [  5%]
tests/test_phase2_ab_benchmark.py::TestAudioAbBenchmarkCli::test_main_writes_json_schema PASSED [  5%]
tests/test_phase2_ab_benchmark.py::TestAudioAbBenchmarkCli::test_benchmark_backend_reports_effective_backend PASSED [  6%]
tests/test_phase2_audio_manager.py::TestListAudioDevices::test_returns_input_devices PASSED [  7%]
tests/test_phase2_audio_manager.py::TestListAudioDevices::test_returns_empty_on_error PASSED [  7%]
tests/test_phase2_audio_manager.py::TestAudioManager::test_init_defaults PASSED [  8%]
tests/test_phase2_audio_manager.py::TestAudioManager::test_is_alive_false_when_not_started PASSED [  9%]
tests/test_phase2_audio_manager.py::TestAudioManager::test_resolve_device_by_index PASSED [  9%]
tests/test_phase2_audio_manager.py::TestAudioManager::test_resolve_device_by_name PASSED [ 10%]
tests/test_phase2_audio_manager.py::TestAudioManager::test_resolve_device_not_found PASSED [ 11%]
tests/test_phase2_audio_manager.py::TestAudioManager::test_start_new_chunk_creates_wav PASSED [ 11%]
tests/test_phase2_audio_manager.py::TestAudioManager::test_close_chunk_fires_callback PASSED [ 12%]
tests/test_phase2_audio_manager.py::TestAudioManager::test_close_empty_chunk_removes_file PASSED [ 13%]
tests/test_phase2_audio_manager.py::TestAudioManager::test_audio_callback_writes_frames PASSED [ 13%]
tests/test_phase2_audio_manager.py::TestAudioManager::test_audio_callback_rotates_on_duration PASSED [ 14%]
tests/test_phase2_audio_manager.py::TestAudioManager::test_stop_flushes_chunk PASSED [ 15%]
tests/test_phase2_audio_recorder.py::TestAudioRecorder::test_init_defaults PASSED [ 15%]
tests/test_phase2_audio_recorder.py::TestAudioRecorder::test_is_running_false_when_stopped PASSED [ 16%]
tests/test_phase2_audio_recorder.py::TestAudioRecorder::test_stop_when_not_running PASSED [ 16%]
tests/test_phase2_audio_recorder.py::TestAudioRecorder::test_on_chunk_complete_enqueues_with_metadata PASSED [ 17%]
tests/test_phase2_audio_recorder.py::TestAudioRecorder::test_on_chunk_complete_correct_checksum PASSED [ 18%]
tests/test_phase2_audio_recorder.py::TestAudioRecorder::test_on_chunk_complete_skips_empty_wav PASSED [ 18%]
tests/test_phase2_audio_recorder.py::TestAudioRecorder::test_on_chunk_complete_nonexistent_file PASSED [ 19%]
tests/test_phase2_gates.py::TestGate2F01AudioCapture::test_audio_manager_creates_wav PASSED [ 20%]
tests/test_phase2_gates.py::TestGate2F01AudioCapture::test_audio_manager_device_name_sanitized PASSED [ 20%]
tests/test_phase2_gates.py::TestGate2F02VADFiltering::test_vad_filters_silence PASSED [ 21%]
tests/test_phase2_gates.py::TestGate2F02VADFiltering::test_vad_detects_speech_subset PASSED [ 22%]
tests/test_phase2_gates.py::TestGate2F03WhisperTranscription::test_transcriber_produces_text PASSED [ 22%]
tests/test_phase2_gates.py::TestGate2F03WhisperTranscription::test_transcriber_handles_empty_audio PASSED [ 23%]
tests/test_phase2_gates.py::TestGate2F04AudioFTSIndexed::test_fts_insert_and_match PASSED [ 24%]
tests/test_phase2_gates.py::TestGate2F04AudioFTSIndexed::test_fts_no_results_for_unrelated_query PASSED [ 24%]
tests/test_phase2_gates.py::TestGate2F05UnifiedTimeline::test_timeline_default_is_video_only PASSED [ 25%]
tests/test_phase2_gates.py::TestGate2P01TranscriptionLatency::test_transcription_completes_within_budget PASSED [ 26%]
tests/test_phase2_gates.py::TestGate2P02VADLatency::test_vad_completes_within_budget PASSED [ 26%]
tests/test_phase2_gates.py::TestGate2P03Throughput::test_queue_depth_stable PASSED [ 27%]
tests/test_phase2_gates.py::TestGate2P04AudioCaptureCPU::test_callback_based_design PASSED [ 28%]
tests/test_phase2_gates.py::TestGate2Q01WERClean::test_wer_clean_under_threshold PASSED [ 28%]
tests/test_phase2_gates.py::TestGate2Q01WERClean::test_wer_clean_with_one_error PASSED [ 29%]
tests/test_phase2_gates.py::TestGate2Q02WERNoisy::test_wer_noisy_under_threshold PASSED [ 30%]
tests/test_phase2_gates.py::TestGate2Q02WERNoisy::test_wer_noisy_boundary PASSED [ 30%]
tests/test_phase2_gates.py::TestGate2S01Stability::test_24h_continuous_run SKIPPED [ 31%]
tests/test_phase2_gates.py::TestGate2R01VRAM::test_vram_usage_structural SKIPPED [ 32%]
tests/test_phase2_gates.py::TestGate2R02StorageRate::test_wav_file_size_reasonable PASSED [ 32%]
tests/test_phase2_gates.py::TestGate2R02StorageRate::test_daily_storage_estimate PASSED [ 33%]
tests/test_phase2_gates.py::TestGate2DG01Encryption::test_filevault_status_command PASSED [ 33%]
tests/test_phase2_gates.py::TestGate2DG01Encryption::test_luks_check_structural SKIPPED [ 34%]
tests/test_phase2_gates.py::TestGate2DG02Redaction::test_pii_redaction SKIPPED [ 35%]
tests/test_phase2_gates.py::TestGate2DG03Retention::test_cascade_delete_removes_all PASSED [ 35%]
tests/test_phase2_gates.py::TestGate2DG03Retention::test_expired_chunks_detected PASSED [ 36%]
tests/test_phase2_ingestion.py::TestAudioUploadHardShutdown::test_audio_upload_rejected_v1 PASSED [ 37%]
tests/test_phase2_ingestion.py::TestAudioUploadHardShutdown::test_audio_upload_rejected_legacy_api PASSED [ 37%]
tests/test_phase2_ingestion.py::TestAudioUploadHardShutdown::test_audio_upload_rejected_does_not_create_db_entry PASSED [ 38%]
tests/test_phase2_ingestion.py::TestAudioUploadHardShutdown::test_upload_no_file_returns_400 PASSED [ 39%]
tests/test_phase2_ingestion.py::TestAudioUploadHardShutdown::test_upload_no_metadata_returns_400 PASSED [ 39%]
tests/test_phase2_ingestion.py::TestAudioAuditAPIs::test_list_audio_chunks_empty PASSED [ 40%]
tests/test_phase2_ingestion.py::TestAudioAuditAPIs::test_audio_transcriptions_empty PASSED [ 41%]
tests/test_phase2_ingestion.py::TestAudioAuditAPIs::test_queue_status_includes_audio PASSED [ 41%]
tests/test_phase2_performance.py::TestGate2P01TranscriptionLatency::test_mock_transcription_latency PASSED [ 42%]
tests/test_phase2_performance.py::TestGate2P02VADProcessing::test_mock_vad_latency PASSED [ 43%]
tests/test_phase2_performance.py::TestGate2P03Throughput::test_no_backlog_growth_pattern PASSED [ 43%]
tests/test_phase2_performance.py::TestGate2P03Throughput::test_mock_queue_depth_stable PASSED [ 44%]
tests/test_phase2_performance.py::TestGate2P04AudioCaptureCPU::test_audio_manager_structural_attributes PASSED [ 45%]
tests/test_phase2_performance.py::TestGate2P04AudioCaptureCPU::test_audio_manager_callback_writes_frames PASSED [ 45%]
tests/test_phase2_quality.py::TestComputeWER::test_identical_strings PASSED [ 46%]
tests/test_phase2_quality.py::TestComputeWER::test_one_substitution PASSED [ 47%]
tests/test_phase2_quality.py::TestComputeWER::test_completely_wrong PASSED [ 47%]
tests/test_phase2_quality.py::TestComputeWER::test_empty_both PASSED     [ 48%]
tests/test_phase2_quality.py::TestComputeWER::test_empty_reference PASSED [ 49%]
tests/test_phase2_quality.py::TestComputeWER::test_empty_hypothesis PASSED [ 49%]
tests/test_phase2_quality.py::TestComputeWER::test_insertion PASSED      [ 50%]
tests/test_phase2_quality.py::TestComputeWER::test_deletion PASSED       [ 50%]
tests/test_phase2_quality.py::TestComputeWER::test_case_insensitive PASSED [ 51%]
tests/test_phase2_quality.py::TestComputeWER::test_longer_sentence PASSED [ 52%]
tests/test_phase2_quality.py::TestGate2Q01WERClean::test_wer_clean_with_mock_whisper PASSED [ 52%]
tests/test_phase2_quality.py::TestGate2Q01WERClean::test_wer_clean_realistic_error PASSED [ 53%]
tests/test_phase2_quality.py::TestGate2Q01WERClean::test_wer_clean_with_minor_errors PASSED [ 54%]
tests/test_phase2_quality.py::TestGate2Q02WERNoisy::test_wer_noisy_with_mock_whisper PASSED [ 54%]
tests/test_phase2_quality.py::TestGate2Q02WERNoisy::test_wer_noisy_realistic_errors PASSED [ 55%]
tests/test_phase2_quality.py::TestGate2Q02WERNoisy::test_wer_noisy_boundary_case PASSED [ 56%]
tests/test_phase2_search.py::TestAudioFTSSearch::test_insert_and_search_transcription PASSED [ 56%]
tests/test_phase2_search.py::TestAudioFTSSearch::test_search_no_results PASSED [ 57%]
tests/test_phase2_search.py::TestAudioFTSSearch::test_search_audio_fts_pagination PASSED [ 58%]
tests/test_phase2_search.py::TestAudioFTSSearch::test_get_audio_transcriptions_by_time_range PASSED [ 58%]
tests/test_phase2_search.py::TestAudioFTSSearch::test_get_audio_transcriptions_outside_range PASSED [ 59%]
tests/test_phase2_search.py::TestSearchAPIAudio::test_search_endpoint_exists PASSED [ 60%]
tests/test_phase2_search.py::TestSearchAPIAudio::test_search_empty_query PASSED [ 60%]
tests/test_phase2_search.py::TestSearchAPIAudio::test_search_filters_out_audio_candidates PASSED [ 61%]
tests/test_phase2_smoke.py::TestPhase26HardShutdownSmoke::test_audio_upload_rejected_and_timeline_excludes_audio PASSED [ 62%]
tests/test_phase2_smoke.py::TestPhase26HardShutdownSmoke::test_legacy_audio_upload_is_rejected PASSED [ 62%]
tests/test_phase2_smoke.py::TestPhase26HardShutdownSmoke::test_search_filters_out_audio_candidates PASSED [ 63%]
tests/test_phase2_timeline.py::TestTimelineAPI::test_timeline_endpoint_exists PASSED [ 64%]
tests/test_phase2_timeline.py::TestTimelineAPI::test_timeline_empty_range PASSED [ 64%]
tests/test_phase2_timeline.py::TestTimelineAPI::test_timeline_excludes_audio_transcriptions PASSED [ 65%]
tests/test_phase2_timeline.py::TestTimelineAPI::test_timeline_source_filter_audio_returns_empty PASSED [ 66%]
tests/test_phase2_timeline.py::TestTimelineAPI::test_timeline_source_filter_video PASSED [ 66%]
tests/test_phase2_timeline.py::TestTimelineAPI::test_timeline_pagination PASSED [ 67%]
tests/test_phase2_timeline.py::TestTimelineAPI::test_timeline_invalid_times PASSED [ 67%]
tests/test_phase2_timeline.py::TestAudioTranscriptionsAPI::test_transcriptions_endpoint_exists PASSED [ 68%]
tests/test_phase2_timeline.py::TestAudioTranscriptionsAPI::test_transcriptions_with_data PASSED [ 69%]
tests/test_phase2_transcriber.py::TestTranscriptionSegment::test_fields PASSED [ 69%]
tests/test_phase2_transcriber.py::TestWhisperTranscriber::test_init_defaults PASSED [ 70%]
tests/test_phase2_transcriber.py::TestWhisperTranscriber::test_init_custom PASSED [ 71%]
tests/test_phase2_transcriber.py::TestWhisperTranscriber::test_engine_name PASSED [ 71%]
tests/test_phase2_transcriber.py::TestWhisperTranscriber::test_transcribe_no_model_returns_empty PASSED [ 72%]
tests/test_phase2_transcriber.py::TestWhisperTranscriber::test_transcribe_returns_segments PASSED [ 73%]
tests/test_phase2_transcriber.py::TestWhisperTranscriber::test_transcribe_filters_empty_text PASSED [ 73%]
tests/test_phase2_transcriber.py::TestWhisperTranscriber::test_reinit_on_cpu PASSED [ 74%]
tests/test_phase2_vad.py::TestSpeechSegment::test_fields PASSED          [ 75%]
tests/test_phase2_vad.py::TestVadAnalysisResult::test_fields PASSED      [ 75%]
tests/test_phase2_vad.py::TestVadSensitivityMapping::test_sensitivity_high_is_default_mapping PASSED [ 76%]
tests/test_phase2_vad.py::TestVadSensitivityMapping::test_sensitivity_low_applies_mapping PASSED [ 77%]
tests/test_phase2_vad.py::TestVadSensitivityMapping::test_invalid_sensitivity_raises_validation_error PASSED [ 77%]
tests/test_phase2_vad.py::TestVadSensitivityMapping::test_legacy_threshold_overrides_sensitivity_mapping PASSED [ 78%]
tests/test_phase2_vad.py::TestVadSensitivityMapping::test_legacy_min_ratio_overrides_sensitivity_mapping PASSED [ 79%]
tests/test_phase2_vad.py::TestVoiceActivityDetector::test_init_defaults PASSED [ 79%]
tests/test_phase2_vad.py::TestVoiceActivityDetector::test_init_custom PASSED [ 80%]
tests/test_phase2_vad.py::TestVoiceActivityDetector::test_silero_init_failure_falls_back_to_webrtc PASSED [ 81%]
tests/test_phase2_vad.py::TestVoiceActivityDetector::test_no_model_returns_empty PASSED [ 81%]
tests/test_phase2_vad.py::TestVoiceActivityDetector::test_has_speech_delegates_to_get_segments PASSED [ 82%]
tests/test_phase2_vad.py::TestVoiceActivityDetector::test_analyze_chunk_reports_ratio_and_backend PASSED [ 83%]
tests/test_phase2_vad.py::TestVoiceActivityDetector::test_hysteresis_reduces_boundary_chatter PASSED [ 83%]
tests/test_phase2_vad.py::TestVoiceActivityDetector::test_probability_state_machine_transitions_unknown_to_speech PASSED [ 84%]
tests/test_phase2_vad.py::TestVoiceActivityDetector::test_audio_type_uses_1600_input_with_512_silero_core PASSED [ 84%]
tests/test_phase2_vad.py::TestVoiceActivityDetector::test_silero_frame_inference_propagates_recurrent_state PASSED [ 85%]
tests/test_phase2_vad.py::TestVoiceActivityDetector::test_invalid_wav_returns_empty PASSED [ 86%]
tests/test_phase2_worker.py::TestAudioProcessingResult::test_defaults PASSED [ 86%]
tests/test_phase2_worker.py::TestAudioProcessingResult::test_with_error PASSED [ 87%]
tests/test_phase2_worker.py::TestAudioChunkProcessor::test_init_lazy PASSED [ 88%]
tests/test_phase2_worker.py::TestAudioChunkProcessor::test_process_missing_file PASSED [ 88%]
tests/test_phase2_worker.py::TestAudioChunkProcessor::test_process_no_speech PASSED [ 89%]
tests/test_phase2_worker.py::TestAudioChunkProcessor::test_process_filtered_by_ratio_skips_transcriber PASSED [ 90%]
tests/test_phase2_worker.py::TestAudioChunkProcessor::test_process_zero_transcriptions_logs_reason PASSED [ 90%]
tests/test_phase2_worker.py::TestAudioChunkProcessor::test_process_with_speech PASSED [ 91%]
tests/test_phase2_worker.py::TestAudioChunkProcessor::test_gate_uses_speech_frame_ratio_for_filtering PASSED [ 92%]
tests/test_phase2_worker.py::TestAudioChunkProcessor::test_gate_allows_ratio_equal_to_threshold PASSED [ 92%]
tests/test_phase2_worker.py::TestAudioChunkProcessor::test_gate_passes_with_high_frame_ratio_even_if_segments_are_short PASSED [ 93%]
tests/test_phase2_worker.py::TestAudioChunkProcessor::test_gate_passes_and_transcribes_in_audio_type_path PASSED [ 94%]
tests/test_phase2_worker.py::TestAudioProcessingWorker::test_init PASSED [ 94%]
tests/test_phase2_worker.py::TestAudioProcessingWorker::test_stop_event PASSED [ 95%]
tests/test_phase2_worker.py::TestSQLStoreAudioLifecycle::test_insert_audio_chunk PASSED [ 96%]
tests/test_phase2_worker.py::TestSQLStoreAudioLifecycle::test_get_audio_chunk_by_id PASSED [ 96%]
tests/test_phase2_worker.py::TestSQLStoreAudioLifecycle::test_pending_processing_completed_lifecycle PASSED [ 97%]
tests/test_phase2_worker.py::TestSQLStoreAudioLifecycle::test_pending_processing_failed_lifecycle PASSED [ 98%]
tests/test_phase2_worker.py::TestSQLStoreAudioLifecycle::test_reset_stuck_audio_chunks PASSED [ 98%]
tests/test_phase2_worker.py::TestSQLStoreAudioLifecycle::test_get_next_pending_audio_chunk PASSED [ 99%]
tests/test_phase2_worker.py::TestSQLStoreAudioLifecycle::test_audio_chunk_status_counts PASSED [100%]

=========================== short test summary info ============================
SKIPPED [1] tests/test_phase2_gates.py:534: Requires 24 hours of continuous runtime observation
SKIPPED [1] tests/test_phase2_gates.py:547: No GPU available -- VRAM measurement requires nvidia-smi
SKIPPED [1] tests/test_phase2_gates.py:626: Linux-only: LUKS check
SKIPPED [1] tests/test_phase2_gates.py:640: Optional gate -- PII redaction not implemented in Phase 2.0
================= 149 passed, 4 skipped, 5 deselected in 4.30s =================
