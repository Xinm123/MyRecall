============================= test session starts ==============================
platform darwin -- Python 3.11.14, pytest-9.0.2, pluggy-1.6.0 -- /opt/homebrew/Caskroom/miniforge/base/envs/v3/bin/python3.11
cachedir: .pytest_cache
rootdir: /Users/pyw/new/MyRecall
configfile: pytest.ini
plugins: anyio-4.12.1
collecting ... collected 145 items

tests/test_phase1_buffer_pool.py::test_pool_allocates_initial_capacity PASSED [  0%]
tests/test_phase1_buffer_pool.py::test_pool_expands_to_power_of_two PASSED [  1%]
tests/test_phase1_buffer_pool.py::test_pool_uses_temporary_buffer_when_above_limit PASSED [  2%]
tests/test_phase1_degradation.py::TestFFmpegCrashRecovery::test_restart_count_increments PASSED [  2%]
tests/test_phase1_degradation.py::TestFFmpegCrashRecovery::test_restart_count_resets_after_hour PASSED [  3%]
tests/test_phase1_degradation.py::TestFFmpegCrashRecovery::test_restart_count_last_hour_property PASSED [  4%]
tests/test_phase1_degradation.py::TestFFmpegCrashRecovery::test_restart_count_last_hour_current_window PASSED [  4%]
tests/test_phase1_degradation.py::TestFFmpegCrashRecovery::test_watchdog_detects_crash PASSED [  5%]
tests/test_phase1_degradation.py::TestDiskFullDegradation::test_check_disk_full_normal PASSED [  6%]
tests/test_phase1_degradation.py::TestDiskFullDegradation::test_check_disk_full_simulated PASSED [  6%]
tests/test_phase1_degradation.py::TestDiskFullDegradation::test_disk_full_flag_transitions PASSED [  7%]
tests/test_phase1_degradation.py::TestDualModeRecording::test_screenshot_mode PASSED [  8%]
tests/test_phase1_degradation.py::TestDualModeRecording::test_video_mode PASSED [  8%]
tests/test_phase1_degradation.py::TestDualModeRecording::test_auto_mode_fallback PASSED [  9%]
tests/test_phase1_degradation.py::TestUploadResume::test_upload_video_chunk_file_not_found PASSED [ 10%]
tests/test_phase1_degradation.py::TestUploadResume::test_upload_video_chunk_already_completed PASSED [ 11%]
tests/test_phase1_frame_extractor.py::TestFrameExtractorExtraction::test_extract_frames_returns_list PASSED [ 11%]
tests/test_phase1_frame_extractor.py::TestFrameExtractorExtraction::test_extracted_frames_have_correct_attributes PASSED [ 12%]
tests/test_phase1_frame_extractor.py::TestFrameExtractorExtraction::test_frame_timestamps_are_sequential PASSED [ 13%]
tests/test_phase1_frame_extractor.py::TestFrameExtractorExtraction::test_frame_pngs_are_valid_images PASSED [ 13%]
tests/test_phase1_frame_extractor.py::TestFrameExtractorDedup::test_dedup_with_static_video PASSED [ 14%]
tests/test_phase1_frame_extractor.py::TestFrameExtractorDedup::test_dedup_threshold_high_keeps_all PASSED [ 15%]
tests/test_phase1_frame_extractor.py::TestFrameExtractorDedup::test_changing_video_keeps_more_frames PASSED [ 15%]
tests/test_phase1_frame_extractor.py::TestFrameExtractorFFmpeg::test_run_ffmpeg_extraction PASSED [ 16%]
tests/test_phase1_frame_extractor.py::TestFrameExtractorFFmpeg::test_run_ffmpeg_invalid_path PASSED [ 17%]
tests/test_phase1_frame_extractor.py::TestFrameExtractorSingleFrame::test_extract_single_frame PASSED [ 17%]
tests/test_phase1_frame_extractor.py::TestFrameExtractorSingleFrame::test_extract_single_frame_at_zero PASSED [ 18%]
tests/test_phase1_frame_extractor.py::TestFrameExtractorSingleFrame::test_extract_single_frame_invalid_path PASSED [ 19%]
tests/test_phase1_frame_extractor.py::TestFrameExtractorPerformance::test_extraction_latency PASSED [ 20%]
tests/test_phase1_gates.py::TestGate1F01Recording::test_ffmpeg_command_builds PASSED [ 20%]
tests/test_phase1_gates.py::TestGate1F01Recording::test_video_recorder_chunk_metadata PASSED [ 21%]
tests/test_phase1_gates.py::TestGate1F02FramesInDB::test_frames_inserted_after_processing PASSED [ 22%]
tests/test_phase1_gates.py::TestGate1F03OCRInFTS::test_ocr_text_in_fts PASSED [ 22%]
tests/test_phase1_gates.py::TestGate1F04TimelineAPI::test_timeline_query PASSED [ 23%]
tests/test_phase1_gates.py::TestGate1F05SearchReturnsVideo::test_video_fts_search_returns_results PASSED [ 24%]
tests/test_phase1_gates.py::TestGate1P01ExtractionLatency::test_extraction_performance PASSED [ 24%]
tests/test_phase1_gates.py::TestGate1D01CrashRestart::test_restart_mechanism PASSED [ 25%]
tests/test_phase1_gates.py::TestGate1D02DiskFull::test_disk_full_detection PASSED [ 26%]
tests/test_phase1_gates.py::TestGate1D04NetworkDown::test_upload_failure_returns_false PASSED [ 26%]
tests/test_phase1_gates.py::TestGate1DG01FilesystemEncryption::test_filevault_status_check PASSED [ 27%]
tests/test_phase1_gates.py::TestGate1DG02AutoDelete::test_expired_chunks_detected PASSED [ 28%]
tests/test_phase1_gates.py::TestGate1DG02AutoDelete::test_cascade_delete_works PASSED [ 28%]
tests/test_phase1_gates.py::TestGate1S01Stability::test_7_day_stability SKIPPED [ 29%]
tests/test_phase1_gates.py::TestGate1S02UploadSuccess::test_upload_success_rate SKIPPED [ 30%]
tests/test_phase1_gates.py::TestGate1R01DiskUsage::test_disk_usage SKIPPED [ 31%]
tests/test_phase1_gates.py::TestGate1R02MemoryUsage::test_memory_usage SKIPPED [ 31%]
tests/test_phase1_gates.py::TestGate1P02E2ELatency::test_e2e_latency SKIPPED [ 32%]
tests/test_phase1_gates.py::TestGate1P03CPUOverhead::test_cpu_overhead SKIPPED [ 33%]
tests/test_phase1_gates.py::TestGate1Q01OCRAccuracy::test_ocr_accuracy SKIPPED [ 33%]
tests/test_phase1_gates.py::TestGate1Q02DedupAccuracy::test_dedup_accuracy PASSED [ 34%]
tests/test_phase1_gates.py::TestGate1DG03PIIDetection::test_pii_detection SKIPPED [ 35%]
tests/test_phase1_monitor_metadata_migration.py::test_migration_adds_monitor_columns PASSED [ 35%]
tests/test_phase1_monitor_metadata_migration.py::test_insert_video_chunk_persists_monitor_metadata PASSED [ 36%]
tests/test_phase1_monitor_metadata_migration.py::test_sql_store_init_auto_applies_video_migrations PASSED [ 37%]
tests/test_phase1_monitor_upload_api.py::test_upload_status_accepts_sha256_prefix PASSED [ 37%]
tests/test_phase1_monitor_upload_api.py::test_legacy_upload_status_accepts_sha256_prefix PASSED [ 38%]
tests/test_phase1_monitor_upload_api.py::test_video_upload_persists_monitor_metadata PASSED [ 39%]
tests/test_phase1_monitor_upload_api.py::test_legacy_upload_routes_video_chunk_to_video_table PASSED [ 40%]
tests/test_phase1_monitor_upload_api.py::test_legacy_video_upload_works_without_manual_migration PASSED [ 40%]
tests/test_phase1_ocr_pipeline.py::TestOCRTextInsertion::test_insert_ocr_text PASSED [ 41%]
tests/test_phase1_ocr_pipeline.py::TestOCRTextInsertion::test_insert_ocr_text_with_engine PASSED [ 42%]
tests/test_phase1_ocr_pipeline.py::TestOCRFTSInsertion::test_insert_ocr_text_fts PASSED [ 42%]
tests/test_phase1_ocr_pipeline.py::TestOCRFTSInsertion::test_fts_search_matches PASSED [ 43%]
tests/test_phase1_ocr_pipeline.py::TestOCRFTSInsertion::test_fts_search_no_match PASSED [ 44%]
tests/test_phase1_ocr_pipeline.py::TestOCRFTSInsertion::test_fts_multiple_frames PASSED [ 44%]
tests/test_phase1_ocr_pipeline.py::TestVideoChunkProcessor::test_processor_with_mock_ocr PASSED [ 45%]
tests/test_phase1_ocr_pipeline.py::TestVideoChunkProcessor::test_processor_handles_ocr_failure PASSED [ 46%]
tests/test_phase1_ocr_pipeline.py::TestVideoChunkProcessor::test_processor_propagates_chunk_app_window_to_frames_and_fts PASSED [ 46%]
tests/test_phase1_pipeline_profile_change.py::test_profile_change_triggers_reconfigure_once PASSED [ 47%]
tests/test_phase1_pipeline_profile_change.py::test_generation_mismatch_frame_is_dropped PASSED [ 48%]
tests/test_phase1_retention.py::TestRetentionQueries::test_get_expired_video_chunks PASSED [ 48%]
tests/test_phase1_retention.py::TestRetentionQueries::test_non_expired_chunks_not_returned PASSED [ 49%]
tests/test_phase1_retention.py::TestRetentionQueries::test_chunks_expired_over_30_days_are_returned PASSED [ 50%]
tests/test_phase1_retention.py::TestRetentionQueries::test_chunks_expiring_in_30_days_are_not_returned PASSED [ 51%]
tests/test_phase1_retention.py::TestRetentionQueries::test_pending_expired_chunks_not_returned PASSED [ 51%]
tests/test_phase1_retention.py::TestCascadeDelete::test_delete_video_chunk_cascade PASSED [ 52%]
tests/test_phase1_retention.py::TestCascadeDelete::test_fts_cleaned_on_cascade PASSED [ 53%]
tests/test_phase1_retention.py::TestRetentionWorker::test_cleanup_expired_video_chunks PASSED [ 53%]
tests/test_phase1_retention.py::TestRetentionWorker::test_cleanup_31_day_expired_chunk_deletes_all_related_data FAILED [ 54%]
tests/test_phase1_retention.py::TestRetentionWorker::test_retention_worker_stop PASSED [ 55%]
tests/test_phase1_sck_stride_unpadding.py::test_pack_nv12_planes_removes_padding PASSED [ 55%]
tests/test_phase1_sck_stride_unpadding.py::test_pack_bgra_plane_removes_padding PASSED [ 56%]
tests/test_phase1_search_debug_render.py::test_search_debug_handles_video_frame_only_rows PASSED [ 57%]
tests/test_phase1_search_debug_render.py::test_search_impl_debug_logging_handles_video_only_candidates PASSED [ 57%]
tests/test_phase1_search_integration.py::TestVideoFTSSearch::test_search_returns_matching_frames PASSED [ 58%]
tests/test_phase1_search_integration.py::TestVideoFTSSearch::test_search_returns_metadata PASSED [ 59%]
tests/test_phase1_search_integration.py::TestVideoFTSSearch::test_search_respects_limit PASSED [ 60%]
tests/test_phase1_search_integration.py::TestSQLStoreVideoMethods::test_insert_and_get_video_chunk PASSED [ 60%]
tests/test_phase1_search_integration.py::TestSQLStoreVideoMethods::test_video_chunk_status_transitions PASSED [ 61%]
tests/test_phase1_search_integration.py::TestSQLStoreVideoMethods::test_video_chunk_failed_status PASSED [ 62%]
tests/test_phase1_search_integration.py::TestSQLStoreVideoMethods::test_get_next_pending_fifo PASSED [ 62%]
tests/test_phase1_search_integration.py::TestSQLStoreVideoMethods::test_reset_stuck_video_chunks PASSED [ 63%]
tests/test_phase1_search_integration.py::TestSQLStoreVideoMethods::test_insert_and_get_frame PASSED [ 64%]
tests/test_phase1_search_integration.py::TestSQLStoreVideoMethods::test_query_frames_by_time_range PASSED [ 64%]
tests/test_phase1_search_integration.py::TestSQLStoreVideoMethods::test_insert_frames_batch PASSED [ 65%]
tests/test_phase1_server_startup.py::test_server_main_starts_background_worker PASSED [ 66%]
tests/test_phase1_server_startup.py::test_server_main_starts_video_worker PASSED [ 66%]
tests/test_phase1_server_startup.py::test_server_preload_ai_models_includes_ocr_warmup PASSED [ 67%]
tests/test_phase1_timeline_api.py::TestTimelineAPI::test_timeline_returns_paginated_response PASSED [ 68%]
tests/test_phase1_timeline_api.py::TestTimelineAPI::test_timeline_time_range_filter PASSED [ 68%]
tests/test_phase1_timeline_api.py::TestTimelineAPI::test_timeline_pagination PASSED [ 69%]
tests/test_phase1_timeline_api.py::TestTimelineAPI::test_timeline_frame_urls PASSED [ 70%]
tests/test_phase1_timeline_api.py::TestTimelineAPI::test_timeline_empty_range PASSED [ 71%]
tests/test_phase1_timeline_api.py::TestTimelineAPI::test_timeline_accepts_page_and_page_size PASSED [ 71%]
tests/test_phase1_timeline_api.py::TestTimelineAPI::test_timeline_limit_offset_take_precedence_over_page_aliases PASSED [ 72%]
tests/test_phase1_timeline_api.py::TestTimelineAPI::test_legacy_timeline_page_uses_frame_urls PASSED [ 73%]
tests/test_phase1_timeline_api.py::TestTimelineAPI::test_legacy_memories_recent_returns_frame_image_url PASSED [ 73%]
tests/test_phase1_timeline_api.py::TestFrameServingAPI::test_serve_existing_frame PASSED [ 74%]
tests/test_phase1_timeline_api.py::TestFrameServingAPI::test_serve_nonexistent_frame PASSED [ 75%]
tests/test_phase1_timeline_api.py::TestVideoUploadAPI::test_upload_video_chunk PASSED [ 75%]
tests/test_phase1_timeline_api.py::TestVideoUploadAPI::test_upload_screenshot_still_works PASSED [ 76%]
tests/test_phase1_timeline_api.py::TestUploadStatusAPI::test_upload_status_not_found PASSED [ 77%]
tests/test_phase1_timeline_api.py::TestUploadStatusAPI::test_upload_status_missing_checksum PASSED [ 77%]
tests/test_phase1_timeline_api.py::TestSearchPaginationCompatibility::test_search_accepts_page_and_page_size_when_query_empty PASSED [ 78%]
tests/test_phase1_timeline_api.py::TestSearchPaginationCompatibility::test_search_limit_offset_take_precedence_when_both_styles_provided PASSED [ 79%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerCommand::test_build_command_has_required_flags PASSED [ 80%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerCommand::test_build_command_platform_specific PASSED [ 80%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerCommand::test_build_command_darwin_detects_screen_index PASSED [ 81%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerCommand::test_build_command_darwin_honors_device_override PASSED [ 82%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerCommand::test_build_command_darwin_fallbacks_to_screen_name PASSED [ 82%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerCommand::test_build_command_includes_segment_list PASSED [ 83%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerCommand::test_custom_resolution_adds_scale_filter PASSED [ 84%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerLifecycle::test_check_ffmpeg_available PASSED [ 84%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerLifecycle::test_start_creates_process PASSED [ 85%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerLifecycle::test_stop_terminates_process PASSED [ 86%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerLifecycle::test_restart_increments_counter PASSED [ 86%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerLifecycle::test_restart_count_resets_after_hour PASSED [ 87%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerLifecycle::test_restart_count_last_hour_property PASSED [ 88%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerLifecycle::test_restart_count_last_hour_current PASSED [ 88%]
tests/test_phase1_video_recorder.py::TestFFmpegManagerLifecycle::test_start_raises_without_ffmpeg PASSED [ 89%]
tests/test_phase1_video_recorder.py::TestFFmpegRawVideoProfile::test_start_with_profile_builds_rawvideo_input PASSED [ 90%]
tests/test_phase1_video_recorder.py::TestFFmpegRawVideoProfile::test_reconfigure_restarts_on_profile_change PASSED [ 91%]
tests/test_phase1_video_recorder.py::TestFFmpegSegmentPolling::test_read_segment_list_empty PASSED [ 91%]
tests/test_phase1_video_recorder.py::TestFFmpegSegmentPolling::test_read_segment_list_csv PASSED [ 92%]
tests/test_phase1_video_recorder.py::TestFFmpegSegmentPolling::test_poll_segments_detects_new PASSED [ 93%]
tests/test_phase1_video_recorder.py::TestFFmpegSegmentPolling::test_poll_segments_no_duplicate PASSED [ 93%]
tests/test_phase1_video_recorder.py::TestFFmpegSegmentPolling::test_on_chunk_complete_callback PASSED [ 94%]
tests/test_phase1_video_recorder.py::TestVideoRecorder::test_on_chunk_complete_builds_metadata PASSED [ 95%]
tests/test_phase1_video_recorder.py::TestVideoRecorder::test_on_chunk_complete_skips_empty PASSED [ 95%]
tests/test_phase1_video_recorder.py::TestVideoRecorder::test_on_chunk_complete_skips_missing PASSED [ 96%]
tests/test_phase1_video_recorder.py::TestVideoRecorder::test_check_disk_full PASSED [ 97%]
tests/test_phase1_video_recorder.py::TestVideoRecorder::test_compute_checksum PASSED [ 97%]
tests/test_phase1_video_recorder.py::TestVideoRecorder::test_stop_sets_flag PASSED [ 98%]
tests/test_phase1_video_recorder.py::TestVideoRecorder::test_runtime_pause_stops_sources_not_pipelines PASSED [ 99%]
tests/test_phase1_video_recorder.py::TestVideoRecorder::test_runtime_resume_restarts_sources_from_existing_pipelines PASSED [100%]

=================================== FAILURES ===================================
_ TestRetentionWorker.test_cleanup_31_day_expired_chunk_deletes_all_related_data _

self = <test_phase1_retention.TestRetentionWorker object at 0x121aad6d0>
sql_store = <openrecall.server.database.sql.SQLStore object at 0x375a5bb10>
tmp_path = PosixPath('/private/var/folders/q2/gtfbxhrj7zv1xn9cn6f3pzj40000gn/T/pytest-of-pyw/pytest-98/test_cleanup_31_day_expired_ch0')

    def test_cleanup_31_day_expired_chunk_deletes_all_related_data(self, sql_store, tmp_path):
        """31-day expired COMPLETED chunk cleanup deletes DB rows + files + FTS."""
        from openrecall.server.retention import RetentionWorker
        from openrecall.shared.config import settings
    
        video_file = tmp_path / "expired31_video.mp4"
        video_file.write_bytes(b"video data")
        chunk_id, frame_ids = _seed_expired_chunk(
            settings.db_path,
            str(video_file),
            settings.frames_path,
            num_frames=2,
            days_ago=31,
        )
    
        conn = sqlite3.connect(str(settings.db_path))
        frame_count_before = conn.execute(
            "SELECT COUNT(*) FROM frames WHERE video_chunk_id=?",
            (chunk_id,),
        ).fetchone()[0]
        ocr_count_before = conn.execute(
            "SELECT COUNT(*) FROM ocr_text WHERE frame_id IN (SELECT id FROM frames WHERE video_chunk_id=?)",
            (chunk_id,),
        ).fetchone()[0]
        fts_count_before = conn.execute(
            "SELECT COUNT(*) FROM ocr_text_fts WHERE frame_id IN (SELECT id FROM frames WHERE video_chunk_id=?)",
            (chunk_id,),
        ).fetchone()[0]
        conn.close()
    
        assert frame_count_before == 2
        assert ocr_count_before == 2
        assert fts_count_before == 2
    
        worker = RetentionWorker()
        worker._cleanup_expired_video_chunks(sql_store)
    
        assert not video_file.exists()
        for fid in frame_ids:
>           assert not (settings.frames_path / f"{fid}.png").exists()
E           AssertionError: assert not True
E            +  where True = exists()
E            +    where exists = (PosixPath('/private/var/folders/q2/gtfbxhrj7zv1xn9cn6f3pzj40000gn/T/pytest-of-pyw/pytest-98/test_cleanup_31_day_expired_ch0/MRS/frames') / '1.png').exists
E            +      where PosixPath('/private/var/folders/q2/gtfbxhrj7zv1xn9cn6f3pzj40000gn/T/pytest-of-pyw/pytest-98/test_cleanup_31_day_expired_ch0/MRS/frames') = Settings(debug=True, capture_interval=10, host='127.0.0.1', port=8083, primary_monitor_only=True, server_data_dir=PosixPath('/private/var/folders/q2/gtfbxhrj7zv1xn9cn6f3pzj40000gn/T/pytest-of-pyw/pytest-98/test_cleanup_31_day_expired_ch0/MRS'), client_data_dir=PosixPath('/private/var/folders/q2/gtfbxhrj7zv1xn9cn6f3pzj40000gn/T/pytest-of-pyw/pytest-98/test_cleanup_31_day_expired_ch0/MRC'), base_path_legacy=PosixPath('/private/var/folders/q2/gtfbxhrj7zv1xn9cn6f3pzj40000gn/T/pytest-of-pyw/pytest-98/test_cleanup_31_day_expired_ch0'), cache_dir=None, client_screenshots_dir=None, api_url='http://localhost:8083/api', device='cpu', upload_timeout=180, ai_request_timeout=120, preload_models=True, ai_provider='local', ai_model_name='', ai_api_key='', ai_api_base='', vision_provider='', vision_model_name='', vision_api_key='', vision_api_base='', ocr_provider='', ocr_model_name='', ocr_api_key='', ocr_api_base='', ocr_rapid_use_local=False, ocr_rapid_model_dir=None, ocr_rapid_det_model=None, ocr_rapid_rec_model=None, ocr_rapid_cls_model=None, embedding_provider='', embedding_api_model_name='', embedding_api_key='', embedding_api_base='', embedding_model_name='qwen-text-v1', keyword_strategy='local', embedding_dim=1024, reranker_mode='api', reranker_url='http://localhost:8080/rerank', reranker_model='Qwen/Qwen3-Reranker-0.6B', reranker_api_key='', processing_lifo_threshold=10, show_ai_description=True, user_idle_threshold_seconds=60, similarity_threshold=0.98, disable_similarity_filter=False, client_save_local_screenshots=False, fusion_log_enabled=False, deployment_mode='local', recording_mode='auto', video_chunk_duration=60, video_fps=30, video_crf=23, video_monitor_ids='', video_pipeline_restart_on_profile_change=True, video_pool_max_bytes=67108864, video_segment_stagger_seconds=2, video_pipe_write_warn_ms=50, video_color_range='auto', frame_extraction_interval=5.0, frame_dedup_threshold=0.95, retention_days=30, retention_check_interval=21600).frames_path

tests/test_phase1_retention.py:292: AssertionError
=========================== short test summary info ============================
SKIPPED [1] tests/test_phase1_gates.py:324: Requires 7 calendar days of runtime observation
SKIPPED [1] tests/test_phase1_gates.py:332: Requires 24h runtime monitoring
SKIPPED [1] tests/test_phase1_gates.py:340: Requires 24h disk usage measurement
SKIPPED [1] tests/test_phase1_gates.py:348: Requires runtime memory measurement
SKIPPED [1] tests/test_phase1_gates.py:356: Requires real video recording and processing pipeline
SKIPPED [1] tests/test_phase1_gates.py:364: Requires 1h CPU measurement
SKIPPED [1] tests/test_phase1_gates.py:372: Requires 100-frame curated test dataset
SKIPPED [1] tests/test_phase1_gates.py:424: Optional gate - PII detection not implemented in Phase 1
FAILED tests/test_phase1_retention.py::TestRetentionWorker::test_cleanup_31_day_expired_chunk_deletes_all_related_data
================== 1 failed, 136 passed, 8 skipped in 10.86s ===================
